<html><head><base href="/" />
<meta charset="UTF-8">
<title>Juzgado Vial Zona Este</title>

<style>
:root {
  --primary-blue: #00BCD4;
  --secondary-blue: #0097A7;
  --primary-green: #4CAF50;
  --secondary-green: #388E3C;
  --primary-orange: #FF9800;
  --secondary-orange: #F57C00;
}

/* Estilos generales */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background: #f0f2f5;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
}

.header {
    background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
    color: white;
    padding: 20px;
    text-align: center;
    border-radius: 8px;
    margin-bottom: 30px;
}

.search-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    max-width: 80%;
    margin-left: auto;
    margin-right: auto;
}

.tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.tab-button {
    padding: 10px 20px;
    border: none;
    background: var(--primary-orange);
    color: white;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
}

.tab-button:hover {
    background: var(--secondary-orange);
}

.tab-button.active {
    background: var(--secondary-blue);
}

.form-container {
    max-width: 80%;
    margin: 0 auto;
}

.form-group {
    margin-bottom: 20px;
    max-width: 100%;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

input, select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
}

button {
    background: var(--primary-green);
    color: white;
    padding: 12px 24px;
    font-size: 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

button:hover {
    background: var(--secondary-green);
}

.edit-button {
    background: #2196F3;
    color: white;
    padding: 5px 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.edit-button:hover {
    background: #1976D2;
}

.delete-button {
    background: #dc3545;
    color: white;
    padding: 5px 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-left: 5px;
}

.delete-button:hover {
    background: #c82333;
}

.table-container {
    margin-top: 40px;
    overflow-x: auto;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

table {
    width: 100%;
    border-collapse: collapse;
}

th, td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

th {
    background: var(--primary-blue);
    color: white;
    margin: 10px 0;
}

.export-buttons {
    margin-top: 20px;
    display: flex;
    gap: 10px;
}

/* Update search container form group */
.search-container .form-group {
    display: flex;
    gap: 20px;
    align-items: center;
    margin-bottom: 20px;
    max-width: 100%;
}

/* Responsive styling */
@media (max-width: 768px) {
    .container {
        padding: 10px;
    }
    
    .tabs {
        flex-direction: column;
    }
    
    .form-container,
    .search-container {
        max-width: 95%;
    }
    
    .search-container .form-group {
        flex-direction: column;
        gap: 15px;
    }
    
    .search-container button {
        width: 100%;
    }
    
    .export-buttons {
        flex-direction: column;
    }
    
    .table-container {
        overflow-x: auto;
    }
    
    table {
        font-size: 14px;
    }
}

/* Additional table responsiveness */
@media (max-width: 480px) {
    th, td {
        padding: 8px;
        font-size: 12px;
    }
    
    .header h1 {
        font-size: 24px;
    }
}

/* Add to existing CSS */
.table-container a {
    color: #2196F3;
    text-decoration: none;
    margin-right: 5px;
}

.table-container a:hover {
    text-decoration: underline;
}

.table-container td:last-child {
    white-space: nowrap;
}
</style>

<div class="container">
    <div class="header">
        <h1>Juzgado Vial Zona Este</h1>
    </div>

    <div class="search-container">
        <h2>Buscar por DNI</h2>
        <div class="form-group">
            <input type="text" id="searchDni" placeholder="Ingrese DNI">
            <button onclick="buscarPorDNI()">Buscar</button>
        </div>
        <div id="searchResults"></div>
    </div>

    <div class="tabs">
        <button class="tab-button active" onclick="showTab('accidentes')">Accidentes Viales</button>
        <button class="tab-button" onclick="showTab('actas')">Actas</button>
    </div>

    <div id="accidentes" class="tab-content">
        <div class="form-container">
            <h2>Registro de Accidente Vial</h2>
            <form id="accidenteForm">
                <div class="form-group">
                    <label>Número de Expediente:</label>
                    <input type="text" id="expedienteAccidente" required>
                </div>
                <div class="form-group">
                    <label>Número de Accidente:</label>
                    <input type="text" id="numeroAccidente" required>
                </div>
                <div class="form-group">
                    <label>Nombre y Apellido:</label>
                    <input type="text" id="nombreAccidente" required>
                </div>
                <div class="form-group">
                    <label>DNI:</label>
                    <input type="text" id="dniAccidente" required>
                </div>
                <div class="form-group">
                    <label>Fecha del Accidente:</label>
                    <input type="date" id="fechaAccidente" required>
                </div>
                <div class="form-group">
                    <label>Lugar del Hecho:</label>
                    <input type="text" id="lugarAccidente" required>
                </div>
                <div class="form-group">
                    <label>Tipo de Accidente:</label>
                    <select id="tipoAccidente">
                        <option>Colisión</option>
                        <option>Emplace</option>
                        <option>Archivo</option>
                        <option>Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Estado del Accidente:</label>
                    <select id="estadoAccidente">
                        <option>En Proceso</option>
                        <option>Resuelto</option>
                        <option>Pendiente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Fallo (PDF):</label>
                    <input type="file" id="falloPdf" accept=".pdf">
                </div>
                <button type="submit">Guardar Accidente</button>
            </form>
        </div>

        <div class="table-container">
            <h3>Registro de Accidentes</h3>
            <table id="accidentesTable">
                <thead>
                    <tr>
                        <th>Número de Expediente</th>
                        <th>Número de Accidente</th>
                        <th>Nombre y Apellido</th>
                        <th>DNI</th>
                        <th>Fecha</th>
                        <th>Lugar</th>
                        <th>Tipo</th>
                        <th>Estado</th>
                        <th>Fallo</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="export-buttons">
                <button onclick="exportToExcel('accidentes')">Exportar a Excel</button>
               
            </div>
        </div>
    </div>

    <div id="actas" class="tab-content" style="display: none;">
        <div class="form-container">
            <h2>Registro de Acta</h2>
            <form id="actaForm">
                <div class="form-group">
                    <label>Número de Expediente:</label>
                    <input type="text" id="expedienteActa" required>
                </div>
                <div class="form-group">
                    <label>Número de Acta:</label>
                    <input type="text" id="numeroActa" required>
                </div>
                <div class="form-group">
                    <label>Nombre y Apellido:</label>
                    <input type="text" id="nombreActa" required>
                </div>
                <div class="form-group">
                    <label>DNI:</label>
                    <input type="text" id="dniActa" required>
                </div>
                <div class="form-group">
                    <label>Fecha del Acta:</label>
                    <input type="date" id="fechaActa" required>
                </div>
                <div class="form-group">
                    <label>Tipo de Infracción:</label>
                    <input type="text" id="tipoInfraccion" required>
                </div>
                <div class="form-group">
                    <label>¿Con Secuestro?</label>
                    <select id="conSecuestro">
                        <option value="No">No</option>
                        <option value="Sí">Sí</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor de la Multa:</label>
                    <input type="number" id="valorMulta" required>
                </div>
                <button type="submit">Guardar Acta</button>
            </form>
        </div>

        <div class="table-container">
            <h3>Registro de Actas</h3>
            <table id="actasTable">
                <thead>
                    <tr>
                        <th>Número de Expediente</th>
                        <th>Número de Acta</th>
                        <th>Nombre y Apellido</th>
                        <th>DNI</th>
                        <th>Fecha</th>
                        <th>Tipo de Infracción</th>
                        <th>Con Secuestro</th>
                        <th>Valor de Multa</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="export-buttons">
                <button onclick="exportToExcel('actas')">Exportar a Excel</button>
                
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

<script>
let accidentesData = JSON.parse(localStorage.getItem('accidentesData')) || [];
let actasData = JSON.parse(localStorage.getItem('actasData')) || [];
let editingId = null;

function buscarPorDNI() {
    const dni = document.getElementById('searchDni').value;
    const resultsDiv = document.getElementById('searchResults');
    resultsDiv.innerHTML = '';

    const accidentes = accidentesData.filter(a => a.dni === dni);
    const actas = actasData.filter(a => a.dni === dni);

    let html = '<h3>Resultados de la búsqueda:</h3>';
    
    if (accidentes.length > 0) {
        html += '<h4>Accidentes:</h4>';
        accidentes.forEach(acc => {
            html += `<p>Expediente: ${acc.expediente} - Accidente: ${acc.numero} - Estado: ${acc.estado}</p>`;
        });
    }

    if (actas.length > 0) {
        html += '<h4>Actas:</h4>';
        actas.forEach(acta => {
            html += `<p>Expediente: ${acta.expediente} - Acta: ${acta.numero} - Infracción: ${acta.infraccion} - Con Secuestro: ${acta.secuestro}</p>`;
        });
    }

    if (accidentes.length === 0 && actas.length === 0) {
        html += '<p>No se encontraron registros para este DNI.</p>';
    }

    resultsDiv.innerHTML = html;
}

function showTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });
    
    document.getElementById(tabName).style.display = 'block';
    
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });
    document.querySelector(`.tab-button[onclick="showTab('${tabName}')"]`).classList.add('active');
}

function editarRegistro(type, id) {
    editingId = id;
    const data = type === 'accidentes' ? accidentesData[id] : actasData[id];
    
    if (type === 'accidentes') {
        document.getElementById('expedienteAccidente').value = data.expediente;
        document.getElementById('numeroAccidente').value = data.numero;
        document.getElementById('nombreAccidente').value = data.nombre;
        document.getElementById('dniAccidente').value = data.dni;
        document.getElementById('fechaAccidente').value = data.fecha;
        document.getElementById('lugarAccidente').value = data.lugar;
        document.getElementById('tipoAccidente').value = data.tipo;
        document.getElementById('estadoAccidente').value = data.estado;
    } else {
        document.getElementById('expedienteActa').value = data.expediente;
        document.getElementById('numeroActa').value = data.numero;
        document.getElementById('nombreActa').value = data.nombre;
        document.getElementById('dniActa').value = data.dni;
        document.getElementById('fechaActa').value = data.fecha;
        document.getElementById('tipoInfraccion').value = data.infraccion;
        document.getElementById('conSecuestro').value = data.secuestro;
        document.getElementById('valorMulta').value = data.valor;
    }
}

function eliminarRegistro(type, id) {
    if (confirm('¿Está seguro que desea eliminar este registro?')) {
        if (type === 'accidentes') {
            accidentesData.splice(id, 1);
        } else {
            actasData.splice(id, 1);
        }
        updateTable(type);
        saveToLocalStorage();
    }
}

function saveToLocalStorage() {
    localStorage.setItem('accidentesData', JSON.stringify(accidentesData));
    localStorage.setItem('actasData', JSON.stringify(actasData));
}

document.getElementById('accidenteForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const falloPdf = document.getElementById('falloPdf').files[0];
    
    if (falloPdf) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const pdfUrl = event.target.result;
            
            const accidente = {
                expediente: document.getElementById('expedienteAccidente').value,
                numero: document.getElementById('numeroAccidente').value,
                nombre: document.getElementById('nombreAccidente').value,
                dni: document.getElementById('dniAccidente').value,
                fecha: document.getElementById('fechaAccidente').value,
                lugar: document.getElementById('lugarAccidente').value,
                tipo: document.getElementById('tipoAccidente').value,
                estado: document.getElementById('estadoAccidente').value,
                fallo: pdfUrl
            };
    
            if (editingId !== null) {
                accidentesData[editingId] = accidente;
                editingId = null;
            } else {
                accidentesData.push(accidente);
            }
    
            updateTable('accidentes');
            saveToLocalStorage();
            e.target.reset();
            document.getElementById('falloPdf').value = '';
        };
        reader.readAsDataURL(falloPdf);
    } else {
        const accidente = {
            expediente: document.getElementById('expedienteAccidente').value,
            numero: document.getElementById('numeroAccidente').value,
            nombre: document.getElementById('nombreAccidente').value,
            dni: document.getElementById('dniAccidente').value,
            fecha: document.getElementById('fechaAccidente').value,
            lugar: document.getElementById('lugarAccidente').value,
            tipo: document.getElementById('tipoAccidente').value,
            estado: document.getElementById('estadoAccidente').value,
            fallo: ''
        };

        if (editingId !== null) {
            accidentesData[editingId] = accidente;
            editingId = null;
        } else {
            accidentesData.push(accidente);
        }

        updateTable('accidentes');
        saveToLocalStorage();
        e.target.reset();
    }
});

document.getElementById('actaForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const acta = {
        expediente: document.getElementById('expedienteActa').value,
        numero: document.getElementById('numeroActa').value,
        nombre: document.getElementById('nombreActa').value,
        dni: document.getElementById('dniActa').value,
        fecha: document.getElementById('fechaActa').value,
        infraccion: document.getElementById('tipoInfraccion').value,
        secuestro: document.getElementById('conSecuestro').value,
        valor: document.getElementById('valorMulta').value
    };
    
    if (editingId !== null) {
        actasData[editingId] = acta;
        editingId = null;
    } else {
        actasData.push(acta);
    }
    
    updateTable('actas');
    saveToLocalStorage();
    e.target.reset(); 
});

function updateTable(type) {
    const table = document.getElementById(`${type}Table`).getElementsByTagName('tbody')[0];
    table.innerHTML = '';
    
    const data = type === 'accidentes' ? accidentesData : actasData;
    
    data.forEach((item, index) => {
        const row = table.insertRow();
        Object.entries(item).forEach(([key, value]) => {
            const cell = row.insertCell();
            if (key === 'fallo' && value) {
                const viewLink = document.createElement('a');
                viewLink.href = '#';
                viewLink.textContent = 'Ver PDF';
                viewLink.onclick = (e) => {
                    e.preventDefault();
                    const pdfWindow = window.open();
                    pdfWindow.document.write(
                        `<iframe width='100%' height='100%' src='${value}'></iframe>`
                    );
                };
                cell.appendChild(viewLink);
            } else {
                cell.textContent = value || '';
            }
        });
        
        const actionsCell = row.insertCell();
        const editButton = document.createElement('button');
        editButton.textContent = 'Editar';
        editButton.className = 'edit-button';
        editButton.onclick = () => editarRegistro(type, index);
        actionsCell.appendChild(editButton);
        
        const deleteButton = document.createElement('button');
        deleteButton.innerHTML = '🗑️';
        deleteButton.className = 'delete-button';
        deleteButton.onclick = () => eliminarRegistro(type, index);
        actionsCell.appendChild(deleteButton);
    });
}

function exportToExcel(type) {
    const data = type === 'accidentes' ? accidentesData : actasData;

    const formattedData = data.map(item => {
        const exportItem = {...item};
        if(exportItem.fallo) delete exportItem.fallo;
        return exportItem;
    });

    const ws = XLSX.utils.json_to_sheet(formattedData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, type === 'accidentes' ? "Accidentes" : "Actas");
    
    try {
        XLSX.writeFile(wb, `registro_${type}_${new Date().toISOString().split('T')[0]}.xlsx`);
    } catch (error) {
        console.error('Error exporting to Excel:', error);
        alert('Error al exportar a Excel. Por favor intente nuevamente.');
    }
}

function exportToPDF(type) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    const data = type === 'accidentes' ? accidentesData : actasData;
    
    doc.text(`Registro de ${type}`, 10, 10);
    
    let y = 30;
    data.forEach((item, index) => {
        const text = Object.entries(item).map(([key, value]) => `${key}: ${value}`).join(', ');
        doc.text(text, 10, y);
        y += 10;
    });
    
    doc.save(`${type}.pdf`);
}

document.addEventListener('DOMContentLoaded', function() {
    updateTable('accidentes');
    updateTable('actas');
});
</script>
</html>